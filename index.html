<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Vem jobbar idag?</title>

  <!-- Fullscreen / PWA meta tags -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Vem jobbar?">
  <meta name="theme-color" content="#0d0d1a">

  <!-- App Icons -->
  <link rel="icon" type="image/png" href="icon.png">
  <link rel="apple-touch-icon" href="icon.png">
  <link rel="manifest" href="manifest.json">

  <!-- External Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-app-compat.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-firestore-compat.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Application Styles -->
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <!-- Login Screen -->
  <div class="login-screen" id="loginScreen">
    <div class="login-card">
      <div class="login-header">
        <h1 class="login-title">Vem jobbar idag?</h1>
        <p class="login-subtitle">Logga in fÃ¶r att fortsÃ¤tta</p>
      </div>

      <div class="login-form">
        <div class="input-group">
          <span class="input-icon">ğŸ”’</span>
          <input type="password" class="password-input" id="passwordInput" placeholder="Ange lÃ¶senord" autocomplete="current-password">
        </div>

        <button class="login-btn" id="loginBtn">Logga in</button>

        <div class="login-loading" id="loginLoading">
          <div class="spinner"></div>
          <span>Ansluter...</span>
        </div>

        <p class="login-error" id="loginError"></p>
      </div>
    </div>
  </div>

  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Sidebar Menu -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <span class="sidebar-title">Meny</span>
      <button class="sidebar-close" id="closeSidebar">Ã—</button>
    </div>
    <ul class="sidebar-menu">
      <li><a href="#" data-page="schedule" id="menuTodayLink"><span class="icon">ğŸ“…</span> Dagens schema</a></li>
      <li><a href="#" data-page="monthly"><span class="icon">ğŸ—“ï¸</span> Schema</a></li>
      <li><a href="#" data-page="upload"><span class="icon">ğŸ“¤</span> Ladda upp schema</a></li>
      <li><a href="#" data-page="settings"><span class="icon">âš™ï¸</span> InstÃ¤llningar</a></li>
    </ul>
  </nav>

  <!-- Header -->
  <header class="header">
    <button class="menu-btn" id="menuBtn">â˜°</button>
    <h1 class="header-title">Vem jobbar idag?</h1>
    <div class="sync-icon" id="syncIcon" title="Anslutningsstatus">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
        <path d="M3 3v5h5"/>
        <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/>
        <path d="M16 16h5v5"/>
      </svg>
    </div>
  </header>

  <!-- Main Content - Schedule Page -->
  <main class="main-content page active" id="schedulePage">
    <!-- Date Picker -->
    <div class="date-picker">
      <button class="date-nav-btn" id="prevDay">â†</button>
      <div class="date-display" id="dateDisplayBtn">
        <span id="currentDate">Tis 3 feb 2026</span>
        <input type="date" id="nativeDatePicker" class="native-date-picker">
      </div>
      <button class="date-nav-btn" id="nextDay">â†’</button>
    </div>

    <!-- Stats Bar -->
    <div class="stats-bar">
      <div class="working-count">
        <span class="icon">ğŸ‘¥</span>
        <span class="count" id="workingCount">0</span>
        <span>arbetar</span>
      </div>
      <label class="filter-toggle">
        <input type="checkbox" id="showLediga">
        <span class="toggle-switch"></span>
        <span class="toggle-label">Lediga</span>
      </label>
    </div>

    <!-- Employee List -->
    <div class="employee-list" id="employeeList">
      <!-- Cards will be rendered here -->
    </div>
  </main>

  <!-- Monthly Schedule Page -->
  <main class="monthly-page page" id="monthlyPage">
    <!-- Person List View -->
    <div id="personListView">
      <div class="person-list" id="personList">
        <!-- Person name cards will be rendered here -->
      </div>
    </div>

    <!-- Person Schedule View (hidden by default) -->
    <div id="personScheduleView" style="display: none;">
      <!-- Month Picker -->
      <div class="month-picker">
        <button class="date-nav-btn" id="prevMonth">â†</button>
        <div class="month-display" id="monthDisplay">Januari 2026</div>
        <button class="date-nav-btn" id="nextMonth">â†’</button>
      </div>

      <!-- Action Buttons -->
      <div class="schedule-action-btns">
        <button class="export-calendar-btn" id="exportCalBtn">
          <img src="https://pfst.cf2.poecdn.net/base/image/7e32cd6dbe37a1833692c5ec8ed62b3a45812a216a3de7cd897ee63e18640571?w=200&h=200" alt="" class="export-icon">
          <span>Exportera</span>
        </button>
        <button class="holidays-btn" id="holidaysBtn">
          <span class="holidays-icon">ğŸ„</span>
          <span>Helgdagar</span>
        </button>
      </div>

      <!-- Holidays Modal -->
      <div class="holidays-modal" id="holidaysModal">
        <div class="holidays-header">
          <h3>Helgdagar 2026</h3>
          <button class="holidays-close" id="holidaysClose">Ã—</button>
        </div>
        <div class="holidays-list" id="holidaysList">
          <!-- Holidays will be rendered here -->
        </div>
      </div>

      <!-- Person Schedule -->
      <div id="monthlyScheduleList">
        <!-- Person schedule calendar/list will be rendered here -->
      </div>
    </div>
  </main>

  <!-- Upload Page -->
  <main class="upload-page page" id="uploadPage">
    <!-- Upload Zone -->
    <div class="upload-zone" id="uploadZone">
      <span class="upload-icon">ğŸ“„</span>
      <h3>Ladda upp ditt schema</h3>
      <p>Dra och slÃ¤pp din fil hÃ¤r, eller klicka fÃ¶r att vÃ¤lja</p>
      <span class="file-formats">PDF, CSV eller JSON</span>
      <span class="browse-btn">VÃ¤lj fil</span>
      <input type="file" id="fileInput" accept=".pdf,.csv,.json,application/pdf,text/csv,application/json">
    </div>

    <!-- File Preview -->
    <div class="file-preview" id="filePreview">
      <div class="file-icon">ğŸ“„</div>
      <div class="file-info">
        <div class="file-name" id="fileName">schema.pdf</div>
        <div class="file-size" id="fileSize">2.4 MB</div>
      </div>
      <button class="remove-file" id="removeFile">Ã—</button>
    </div>

    <!-- Upload Button -->
    <button class="process-btn" id="processBtn">
      <span>ğŸ“¤</span>
      <span>Ladda upp</span>
    </button>

    <!-- Processing State -->
    <div class="processing-state" id="processingState">
      <div class="spinner"></div>
      <p id="processingText">LÃ¤ser in PDF...</p>
    </div>
  </main>

  <!-- Settings Page -->
  <main class="settings-page page" id="settingsPage">
    <div class="settings-container">
      <div class="settings-section">
        <h3 class="settings-title">Utseende</h3>
        <div class="settings-item">
          <div class="settings-label">
            <span class="settings-icon">ğŸŒ“</span>
            <span>Ljust/MÃ¶rkt</span>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="darkModeToggle">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>

      <!-- Fridagsnyckel (collapsible) -->
      <div class="settings-section collapsible" id="fridagsSection">
        <div class="collapsible-header" id="fridagsHeader">
          <h3 class="settings-title" style="margin-bottom: 0;">ğŸ—“ï¸ Fridagsnyckel</h3>
          <span class="collapsible-arrow">â€º</span>
        </div>
        <div class="collapsible-content" id="fridagsContent">
          <p class="fridag-info">VÃ¤lj fridagsnyckel och startrad fÃ¶r varje anstÃ¤lld. Klicka "Applicera" fÃ¶r att lÃ¤gga in FP/FPV-dagar frÃ¥n 1 mars 2026 till 28 feb 2027.</p>
          <div class="fridag-employee-list" id="fridagEmployeeList">
            <!-- Employees with fridagsnyckel dropdowns will be rendered here -->
          </div>
        </div>
      </div>

      <!-- Radera data (collapsible) -->
      <div class="settings-section collapsible" id="deleteDataSection">
        <div class="collapsible-header" id="deleteDataHeader">
          <h3 class="settings-title" style="margin-bottom: 0;">Radera data</h3>
          <span class="collapsible-arrow">â€º</span>
        </div>
        <div class="collapsible-content" id="deleteDataContent">
          <div class="delete-list" id="deleteEmployeeList">
            <!-- Employees will be rendered here -->
          </div>
        </div>
      </div>

      <!-- App version & updates -->
      <div class="settings-section">
        <h3 class="settings-title">Appversion</h3>
        <div class="version-info">
          <p class="version-text" id="versionText">Vem jobbar idag? v3.7</p>
          <p class="version-status" id="versionStatus"></p>
        </div>
        <button class="update-btn" id="checkUpdateBtn">
          <span class="update-icon">ğŸ”„</span>
          SÃ¶k efter uppdatering
        </button>
      </div>
    </div>
  </main>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" id="deleteConfirmModal">
    <div class="modal-card">
      <div class="modal-icon">âš ï¸</div>
      <h3 class="modal-title">Radera data?</h3>
      <p class="modal-text" id="deleteModalText">Vill du radera all data fÃ¶r denna person?</p>
      <p class="modal-warning">Detta gÃ¥r inte att Ã¥ngra.</p>
      <div class="modal-buttons">
        <button class="modal-btn cancel" id="deleteModalCancel">Avbryt</button>
        <button class="modal-btn danger" id="deleteModalConfirm">Radera</button>
      </div>
    </div>
  </div>

  <!-- Application Scripts (order matters!) -->
  <script src="js/config.js"></script>
  <script src="js/firebase.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/schedule.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/app.js"></script>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then((registration) => {
            console.log('SW registered:', registration.scope);

            // Check for updates
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  // New version available - activate it immediately
                  console.log('New version available, updating...');
                  newWorker.postMessage({ type: 'SKIP_WAITING' });
                }
              });
            });
          })
          .catch((error) => {
            console.log('SW registration failed:', error);
          });

        // Reload page when new service worker takes over
        let refreshing = false;
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          if (!refreshing) {
            refreshing = true;
            console.log('New version activated, reloading...');
            window.location.reload();
          }
        });
      });
    }
  </script>
</body>
</html>
